{% load static %}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Remake the Outfit</title>
        <link rel="stylesheet" href="{% static 'css/style.css' %}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.15/css/jquery.Jcrop.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.15/js/jquery.Jcrop.js"></script>
      </head>
    
    <body>
        <div class="containerrr">
            <div class="mycloset">
                復刻穿搭
            </div>
            
            <button class="tabs__btn" onclick="window.location.href='/clothes'">
                <a href="{% url 'outfits' %}">
                <img class="icon" src="{% static 'images/icon-svg/arrow_left.png' %}"> 
                </a>
            </button> 

            <img src="{% static 'images/icon-svg/refresh.png' %}" class="icon3">

        </div>
    
        <section class="main">
            <div class="addOutfit_left-col">
                <div class="post">
                    <div class="info">
                        <div class="user">
                            
                            <div class="profile-pic"> <img src="{% static 'images/selfie.jpg' %}" alt=""> </div>
                            <p class="username" style="color: rgba(148,122,136,1);">{{ post.user.username }}</p>
                        </div>
                     </div>
                     <div class="post-image">

                        <form id="form" action="{% url 'select_remake' post.id %}" method="post">
                            {% csrf_token %}
                            <div class="post_camera_icon">
                                <img id="image" class="post-image" style="position: relative" src="{{ post.image.url }}"/>
                                <canvas id="canvas" style="position: absolute; top: 8px;left: 8px"></canvas>
                            </div>
                            <button type="button" id="confirm" hidden="True" onclick="getResult()">confirm</button>

                            <input type="submit" value="確認送出" />
                        </form>
                    </div>
                    
                    <div >
                        <div style="padding-bottom: 25px;"></div>
                        
                            <input type="text" class="remake_clothes_font" value="復刻單品" style="background-color:#f3f3f3; border:0; width: 90%; text-align: left;" />  

                        <hr size="1px" color= "#e6e6e6" width="100%"> 


                    </div>

                    <div>


                        <a href="BrowseMyOutfit.html">
                            <div> <img src="{% static 'images/30.jfif' %}" class="remake_clothes_block1"> </div>
                        </a>
                        
                        <hr size="1px" color= "#e6e6e6" width="100%"> 

                        <a href="BrowseMyOutfit.html">
                            <div> <img src="{% static 'images/32.jfif' %}" class="remake_clothes_block2"> </div>
                        </a>

                        <a href="BrowseMyOutfit.html">
                            <div> <img src="{% static 'images/shoes1.webp' %}" class="remake_clothes_block3"> </div>
                        </a>

                        <a href="BrowseMyOutfit.html">
                            <div> <img src="{% static 'images/icon-svg/add.png' %}" class="remake_clothes_block4"> </div>
                        </a>

                        <a href="BrowseMyOutfit.html">
                            <div> <img src="{% static 'images/icon-svg/add.png' %}" class="remake_clothes_block5"> </div>
                        </a>
                        
                        <br>


                    </div>

                </div>
                
            </div>
        
        </section>

        <script>
            let img = document.getElementById("image");
            let element = document.getElementById("confirm");
            let hidden = element.getAttribute("hidden");
            var selectResult;
            var regions = [];
            $(document).ready(function(){
                // make canvas fit the image.
                let canvas = $('#canvas');
                let image = $('#image');
                canvas.width(image.width());
                canvas.height(image.height());

                image.Jcrop({
                    onSelect: function(c){
                        if (hidden) {
                            element.removeAttribute("hidden");
                        }
                        selectResult = $(this).attr('result');
                        selectResult = [c.x,c.y,c.w,c.h]
                    }
                })
            })
            function drawRectangle(left, top, width, height) {
                var canvas = document.getElementById('canvas');
                var context = canvas.getContext('2d');
                var img = document.getElementById('image');
                context.beginPath();
                context.lineWidth = "4";
                context.strokeStyle = "white";
                context.rect(left, top, width, height);
                context.stroke();
            }
            function getResult() {
                drawRectangle(selectResult[0], selectResult[1], selectResult[2], selectResult[3]);
                regions.push(selectResult);
                element.setAttribute("hidden","False");
            }
            function postRegions() {
                let form = $("#form");
                for (let i = 0; i < regions.length; i++) {
                    form.append('<input type="hidden" name="region' + i + '" value="' + JSON.stringify(regions[i]) + '">');
                }
                return true;
            }

            $("#form").submit( function(e) {
                postRegions();
            })
        </script>
    </body>
</html>